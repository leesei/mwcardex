function dumpSpellDBEntry(e){if(LOG_LEVEL_DEBUG){var n=gSpellDB[e];console.debug('"%s": [%s] type[%s] sch[%s] cost[%d]',e,n.name,n.type,n.schools,n.cost)}}function dev_init(){var e,n,o=function(){};if(window.console?window.console.debug||void 0===window.console.log||(window.console.debug=window.console.log):window.console={},n=["verbose","log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],DEV){for(e=0;n.length>e;++e)window.console[n[e]]||(window.console[n[e]]=o);LOG_LEVEL_DEBUG||(console.debug=o,console.dir=o),console.verbose=LOG_LEVEL_VERBOSE?console.log:o}else for(e=0;n.length>e;++e)window.console[n[e]]=o}function monitorAppCacheUpdate(){console.group("monitorAppCacheUpdate()");var e,n=[];n[0]="uncached",n[1]="idle",n[2]="checking",n[3]="downloading",n[4]="updateready",n[5]="obsolete",e=function(e){var i,l,t,s;i=navigator.onLine?"yes":"no",l=n[o.status],t=e.type,s="online: "+i,s+=", event: "+t,s+=", status: "+l,"error"==t&&navigator.onLine&&(s+=" (prolly a syntax error in manifest)"),console.log(s)};var o=window.applicationCache;o.addEventListener("cached",e,!1),o.addEventListener("checking",e,!1),o.addEventListener("downloading",e,!1),o.addEventListener("error",e,!1),o.addEventListener("noupdate",e,!1),o.addEventListener("obsolete",e,!1),o.addEventListener("progress",e,!1),o.addEventListener("updateready",e,!1),o.addEventListener("updateready",function(){window.applicationCache.swapCache(),console.log("swap cache has been called"),window.location.reload()},!1),console.groupEnd()}function init(){console.group("init()");var e=$("#spell-img-holder"),n=$("#school-filters input:checkbox"),o=$("#type-filters input:checkbox");mageInfoInit(),spellListInit(),e.hide().on("load",function(){$(this).fadeIn(FADE_MS_LONG)}),$("#name-filter, #tag-filter").on("change",function(){filterSpells(this)}).on("keydown",function(){clearTimeout(searchTimer),searchTimer=setTimeout(function(){filterSpells(this)},searchTimeout)}).next().on("click",function(){$(this).prev().val("").change()}),$("#school-filter-all").on("click",function(){n.prop("checked",!0),filterSpells(this)}),$("#school-filter-none").on("click",function(){n.prop("checked",!1),filterSpells(this)}),n.prop("checked",!0).on("change",function(){filterSpells(this)}),$("#type-filter-all").on("click",function(){o.prop("checked",!0),filterSpells(this)}),$("#type-filter-none").on("click",function(){o.prop("checked",!1),filterSpells(this)}),o.prop("checked",!0).on("change",function(){filterSpells(this)}),console.groupEnd()}function mageInfoInit(){console.group("mageInfoInit()"),$("#mage-select").on("change",function(){console.debug("render mage[%s] info",this.value),$("#mage-info-holder").html('<img src="mages/'+this.value+'_1.jpg" /> '+'<img src="mages/'+this.value+'_2.jpg" />')}),console.groupEnd()}function spellListInit(){console.group("spellListInit()");var e=[],n=function(e,n){var o,i,l,t=$("#spell-img-holder");o=$("<div>").css("float","right");for(l in n.schools)o.append('<img src="images/'+l+'.png" class="badge-icon">');return i=$(sprintf('<li id="%s" class="type-%s">',e,n.type)).append(sprintf('<a href="#">%s</a>',n.name)).append(o).append($("<div>").addClass("expander")).on("click",function(n){console.verbose("> spell %s clicked",e),n.preventDefault(),-1==t.attr("src").indexOf(e)&&(t.hide(),t.attr("src",sprintf("spells/%s.jpg",e)))})};$.each(gSpellDB,function(o,i){console.verbose("%s: %O",o,i),e.push(n(o,i)),i.name=i.name.toLowerCase()}),e.sort(function(e,n){var o=e.text(),i=n.text();return o==i?0:o>i?1:i>o?-1:void 0}),$("#spell-list-holder").append(e),$("#visible-spell-count").text(e.length),console.groupEnd()}function schoolFilterInit(){console.group("schoolFilterInit()"),console.groupEnd()}function typeFilterInit(){console.group("typeFilterInit()"),console.groupEnd()}function filterSpells(e){console.group("filterSpells (triggerer: %O)",e),$("#spell-img-holder").slideUp(FADE_MS_SHORT),console.time("> [total]");var n,o,i=!1,l=$("#spell-list-holder>li").detach(),t=$("#school-filters input:checkbox"),s=t.filter(":checked"),c={},r=$("#type-filters input:checkbox"),d=r.filter(":checked"),a="",p=$.trim($("#name-filter").val()).toLowerCase(),h=$.trim($("#tag-filter").val()).toLowerCase();l.removeClass("hidden"),console.time("school-filter"),i||(o=s.length,0==o?(console.info("> [school] none selected, quit"),l.addClass("hidden"),i=!0):o==t.length?console.info("> [school] all, skip filtering"):(s.each(function(){c[this.value]=!0}),n=l.filter(':not(".hidden")'),console.log("> [school] filter[%O] on %d checked, %d visible",c,s.length,n.length),n.filter(function(){console.verbose(">> [school] #%s %O",this.id,gSpellDB[this.id].schools);for(var e in gSpellDB[this.id].schools)if(e in c)return!1;return!0}).addClass("hidden"))),console.timeEnd("school-filter"),console.time("type-filter"),i||(o=d.length,0==o?(console.info("> [type] none selected, quit"),l.addClass("hidden"),i=!0):o==r.length?console.info("> [type] all, skip filtering"):(d.each(function(){a+=this.value}),n=l.filter(':not(".hidden")'),console.log("> [type] filter[%s] on %d checked, %d visible",a,d.length,n.length),n.filter(function(){return-1==$.inArray(gSpellDB[this.id].type,a)}).addClass("hidden"))),console.timeEnd("type-filter"),console.time("name-filter"),i||(p.length?(n=l.filter(':not(".hidden")'),console.log("> [name] filter[%s], %d visible",p,n.length),n.filter(function(){return console.verbose('>> [name] "%s" in "%s" = %d',p,gSpellDB[this.id].name,gSpellDB[this.id].name.indexOf(p)),-1==gSpellDB[this.id].name.indexOf(p)}).addClass("hidden")):console.info("> [name] skipped")),console.timeEnd("name-filter"),console.time("tag-filter"),i||(h.length?(n=l.filter(':not(".hidden")'),console.log("> [tag] '%s', %d visible",h,n.length)):console.info("> [tag] skipped")),console.timeEnd("tag-filter"),$("#spell-list-holder").append(l),console.timeEnd("> [total]"),n=l.filter(':not(".hidden")'),console.info("filter done, %d visible",n.length),$("#visible-spell-count").text(n.length),console.groupEnd()}var DEV=0,LOG_LEVEL_DEBUG=1,LOG_LEVEL_VERBOSE=0,searchTimer,searchTimeout=200,FADE_MS_LONG=300,FADE_MS_SHORT=200;$(document).ready(function(){dev_init(),monitorAppCacheUpdate(),init()});