function dumpSpellDBEntry(e){if(LOG_LEVEL_DEBUG){var o=gSpellDB[e];console.debug('"%s": [%s] type[%s] sch[%s] cost[%d]',e,o.name,o.type,o.schools,o.cost)}}function dev_init(){var e,o,n=function(){};if(window.console?window.console.debug||void 0===window.console.log||(window.console.debug=window.console.log):window.console={},o=["verbose","log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],DEV){for(e=0;o.length>e;++e)window.console[o[e]]||(window.console[o[e]]=n);LOG_LEVEL_DEBUG||(console.debug=n,console.dir=n),console.verbose=LOG_LEVEL_VERBOSE?console.log:n}else for(e=0;o.length>e;++e)window.console[o[e]]=n}function monitorAppCacheUpdate(){console.group("monitorAppCacheUpdate()");var e,o=[];o[0]="uncached",o[1]="idle",o[2]="checking",o[3]="downloading",o[4]="updateready",o[5]="obsolete",e=function(e){var i,l,t,s;i=navigator.onLine?"yes":"no",l=o[n.status],t=e.type,s="online: "+i,s+=", event: "+t,s+=", status: "+l,"error"==t&&navigator.onLine&&(s+=" (prolly a syntax error in manifest)"),console.log(s)};var n=window.applicationCache;n.addEventListener("cached",e,!1),n.addEventListener("checking",e,!1),n.addEventListener("downloading",e,!1),n.addEventListener("error",e,!1),n.addEventListener("noupdate",e,!1),n.addEventListener("obsolete",e,!1),n.addEventListener("progress",e,!1),n.addEventListener("updateready",e,!1),n.addEventListener("updateready",function(){window.applicationCache.swapCache(),console.log("swap cache has been called"),window.location.reload()},!1),console.groupEnd()}function init(){console.group("init()");var e=$("#spell-img-holder"),o=$("#school-filters input:checkbox"),n=$("#type-filters input:checkbox");monitorAppCacheUpdate(),mageInfoInit(),spellListInit(),e.hide().on("load",function(){$(this).fadeIn(FADE_MS_LONG)}),$("#name-filter, #tag-filter").on("change",function(){filterSpells(this)}).on("keydown",function(){clearTimeout(searchTimer),searchTimer=setTimeout(function(){filterSpells(this)},searchTimeout)}).next().on("click",function(){$(this).prev().val("").change()}),$("#school-filter-all").on("click",function(){o.prop("checked",!0),filterSpells(this)}),$("#school-filter-none").on("click",function(){o.prop("checked",!1),filterSpells(this)}),o.prop("checked",!0).on("change",function(){filterSpells(this)}),$("#type-filter-all").on("click",function(){n.prop("checked",!0),filterSpells(this)}),$("#type-filter-none").on("click",function(){n.prop("checked",!1),filterSpells(this)}),n.prop("checked",!0).on("change",function(){filterSpells(this)}),console.groupEnd()}function mageInfoInit(){console.group("mageInfoInit()"),$("#mage-select").on("change",function(){console.debug("render mage[%s] info",this.value),$("#mage-info-holder").html('<img src="mages/'+this.value+'_1.jpg" /> '+'<img src="mages/'+this.value+'_2.jpg" />')}),console.groupEnd()}function spellListInit(){console.group("spellListInit()");var e=[],o=$("#spell-list-holder"),n=$("#spell-img-holder"),i=function(e,o){var i,l,t;i=$("<div>").css("float","right");for(t in o.schools)i.append('<img src="images/'+t+'.png" height="30px">');return l=$(sprintf('<li id="%s" class="type-%s">',e,o.type)).append(sprintf('<a href="#">%s</a>',o.name)).append(i).append($("<div>").addClass("expander")).on("click",function(o){console.verbose("> spell %s clicked",e),o.preventDefault(),-1==n.attr("src").indexOf(e)&&(n.hide(),n.attr("src",sprintf("spells/%s.jpg",e)))})};$.each(gSpellDB,function(o,n){console.verbose("%s: %O",o,n),e.push(i(o,n)),n.name=n.name.toLowerCase()}),e.sort(function(e,o){var n=e.text(),i=o.text();return n==i?0:n>i?1:i>n?-1:void 0}),o.append(e),$("#visible-spell-count").text(e.length),$(".nano").nanoScroller(),console.groupEnd()}function schoolFilterInit(){console.group("schoolFilterInit()"),console.groupEnd()}function typeFilterInit(){console.group("typeFilterInit()"),console.groupEnd()}function filterSpells(e){console.group("filterSpells (triggerer: %O)",e),$("#page-spell-list #spell-img-holder").slideUp(FADE_MS_SHORT),console.time("spell-filter-total");var o,n=$("#spell-list-holder>li"),i=$("#school-filters input:checkbox"),l=i.filter(":checked"),t={},s=$("#type-filters input:checkbox"),c=s.filter(":checked"),r="",d=$.trim($("#name-filter").val()).toLowerCase(),a=$.trim($("#tag-filter").val()).toLowerCase();return n.show(),console.time("school-filter"),0==l.length?(console.info("> [school] none selected, return"),n.slideUp(FADE_MS_SHORT),void 0):(l.length==i.length?console.info("> [school] skipped"):(l.each(function(){t[this.value]=!0}),o=n.filter(":visible"),console.log("> [school] filter[%O] on %d checked, %d visible",t,l.length,o.length),o.filter(function(){console.verbose(">> [school] #%s %O",this.id,gSpellDB[this.id].schools);for(var e in gSpellDB[this.id].schools)if(e in t)return!1;return!0}).hide()),console.timeEnd("school-filter"),console.time("type-filter"),0==c.length?(console.info("> [type] none selected, return"),n.slideUp(FADE_MS_SHORT),void 0):(c.length==s.length?console.info("> [type] skipped"):(c.each(function(){r+=this.value}),o=n.filter(":visible"),console.log("> [type] filter[%s] on %d checked, %d visible",r,c.length,o.length),o.filter(function(){return-1==$.inArray(gSpellDB[this.id].type,r)}).hide()),console.timeEnd("type-filter"),console.time("name-filter"),d.length?(o=n.filter(":visible"),console.log("> [name] filter[%s], %d visible",d,o.length),o.filter(function(){return console.verbose('>> [name] "%s" in "%s" = %d',d,gSpellDB[this.id].name,gSpellDB[this.id].name.indexOf(d)),-1==gSpellDB[this.id].name.indexOf(d)}).hide()):console.info("> [name] skipped"),console.timeEnd("name-filter"),console.time("tag-filter"),a.length?(o=n.filter(":visible"),console.log("> [tag] '%s', %d visible",a,o.length)):console.info("> [tag] skipped"),console.timeEnd("tag-filter"),console.timeEnd("spell-filter-total"),console.info("filter done, %d visible",n.filter(":visible").length),$("#visible-spell-count").text(n.filter(":visible").length),console.groupEnd(),void 0))}var DEV=0,LOG_LEVEL_DEBUG=1,LOG_LEVEL_VERBOSE=0,searchTimer,searchTimeout=200,FADE_MS_LONG=300,FADE_MS_SHORT=200;$(document).ready(function(){dev_init(),init()});